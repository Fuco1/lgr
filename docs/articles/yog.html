<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Yet Another Log4j Inspired Logging Framework • yog</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Yet Another Log4j Inspired Logging Framework">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">yog</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.5.9012</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/yog.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/yog-examples.html">Example Configurations for yog</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/s-fleck/yog">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Yet Another Log4j Inspired Logging Framework</h1>
                        <h4 class="author">Stefan Fleck</h4>
            
            <h4 class="date">2018-12-24</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/s-fleck/yog/blob/master/vignettes/yog.Rmd"><code>vignettes/yog.Rmd</code></a></small>
      <div class="hidden name"><code>yog.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p>Yog is a logging framework for R inspired by <a href="https://logging.apache.org/log4j/2.x/">Apache Log4j</a> and <a href="https://docs.python.org/3/library/logging.html">Python logging</a>. It follows a traditional object oriented design implemented through <a href="https://github.com/r-lib/R6">R6 classes</a>. This enables yog to have a larger set of features than other logging packages for R, and makes it easy to extend for people that have experience with R6 classes.</p>
<div id="quickstart" class="section level2">
<h2 class="hasAnchor">
<a href="#quickstart" class="anchor"></a>Quickstart</h2>
<p>Configure a new logger that writes all log messages of level <em>info</em> or more to a text file and of level <em>error</em> or more to a json file.</p>
<p><strong>Setup:</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tfi &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/tempfile">tempfile</a></span>(<span class="dt">fileext =</span> <span class="st">".info"</span>)
tfe &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/tempfile">tempfile</a></span>(<span class="dt">fileext =</span> <span class="st">".error"</span>)
l &lt;-<span class="st"> </span>Logger<span class="op">$</span><span class="kw">new</span>(
  <span class="st">"example Logger"</span>,
  <span class="dt">appenders =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(
    AppenderFile<span class="op">$</span><span class="kw">new</span>(tfi, <span class="dt">threshold =</span> <span class="st">"info"</span>),
    AppenderFile<span class="op">$</span><span class="kw">new</span>(tfe, <span class="dt">threshold =</span> <span class="st">"error"</span>, <span class="dt">layout =</span> LayoutJson<span class="op">$</span><span class="kw">new</span>())
  )
)</code></pre></div>
<p><strong>Usage:</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">l<span class="op">$</span><span class="kw">info</span>(<span class="st">"Everything is okay"</span>)
<span class="co">#&gt; INFO  [13:10:06.924] Everything is okay</span>
l<span class="op">$</span><span class="kw">error</span>(<span class="st">"Everything is NOT okay"</span>)
<span class="co">#&gt; ERROR [13:10:06.985] Everything is NOT okay</span>
l<span class="op">$</span><span class="kw">fatal</span>(<span class="st">"NOTHING is okay"</span>)
<span class="co">#&gt; FATAL [13:10:07.048] NOTHING is okay</span>
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/readLines">readLines</a></span>(tfi)
<span class="co">#&gt; [1] "INFO  [2018-12-24 13:10:06.924] Everything is okay"    </span>
<span class="co">#&gt; [2] "ERROR [2018-12-24 13:10:06.985] Everything is NOT okay"</span>
<span class="co">#&gt; [3] "FATAL [2018-12-24 13:10:07.048] NOTHING is okay"</span>
<span class="kw"><a href="../reference/read_json_lines.html">read_json_lines</a></span>(tfe)
<span class="co">#&gt;   level           timestamp caller                    msg</span>
<span class="co">#&gt; 1   200 2018-12-24 13:10:06   eval Everything is NOT okay</span>
<span class="co">#&gt; 2   100 2018-12-24 13:10:07   eval        NOTHING is okay</span></code></pre></div>
</div>
</div>
<div id="usage" class="section level1">
<h1 class="hasAnchor">
<a href="#usage" class="anchor"></a>Usage</h1>
<div id="structure-of-the-logging-system" class="section level2">
<h2 class="hasAnchor">
<a href="#structure-of-the-logging-system" class="anchor"></a>Structure of the Logging System</h2>
<p>If you want custom logging configurations, you have to understand the structure of the logging process.</p>
<ul>
<li>A <strong>Logger</strong> collects information and dispatches it to its <em>Appenders</em>, and also the <em>Appenders</em> of its <em>Parent Loggers</em> (also see the section on hierarchical logging)</li>
<li>An <strong>Appender</strong> writes the log message to destination (the console, a file, a database, etc…).</li>
<li>A <strong>Layout</strong> is used by an Appender to format LogRecords. For example, <code>AppenderFile</code> uses <code>LayoutFormat</code> by default to write human readable log events to a text file, but can also use <code>LayoutJson</code> produce machine readable JSON lines logfiles.</li>
<li>
<strong>LogEvents</strong> are produced by the Logger and dispatched to Appenders. They contain all the information that is beeing logged (think of it as a row in table). LogEvents usually contain the log level, a timestamp, a message, the name of the calling function, and a <a href="https://adv-r.hadley.nz/r6.html#r6-semantics%5D">reference</a> to the Logger that created it. In addition, a LogEvent can contain any number of custom fields, but not all Appenders/Layouts support custom fields. For example if you use <code>AppenderFormat</code> with <code>LayoutFormat</code> you can only use the standard fields in your log message, while <code>LayoutJson</code> supports custom fields in a quite natural manner. See <a href="#examples">examples 1 &amp; 2</a>
</li>
</ul>
<div id="on-r6-classes" class="section level3">
<h3 class="hasAnchor">
<a href="#on-r6-classes" class="anchor"></a>On R6 Classes</h3>
<p>The elements described above are R6 classes. R6 is an object orientation system for R that is used by many popular packages such as shiny, dplyr, plumber, roxygen2, and testthat but often behind the scenes and not as exposed as in yog.</p>
<p>You recognize R6 classes in this package because they are named following the UpperCamelCase naming convention. While there is only one kind of Logger and one kind of LogEvent, there are several subclasses of Appenders and Layouts.</p>
<p>An introduction to R6 classes is beyond the scope of this document, but you can find the official documentation <a href="https://r6.r-lib.org/">here</a> and there is also this <a href="https://www.youtube.com/watch?v=3GEFd8rZQgY">talk on youtube</a>. In short R6 classes store data (fields) together with functions (methods) and have to be instantiated with <code>&lt;classname&gt;$new()</code>. So if you want to create a new <code>AppenderFile</code>, you do this by calling <code>AppenderFile$new(file = tempfile())</code>.</p>
</div>
</div>
<div id="log-levels" class="section level2">
<h2 class="hasAnchor">
<a href="#log-levels" class="anchor"></a>Log Levels</h2>
<p>Yog supports the standard log4j Log Levels outlined bellow. The Log Level of an event represents its severity. The named log levels are really just nicknames vor integer values, and you can use the <code>character</code> or <code>integer</code> representations interchangably. You can also use arbitrary integer values (greater than <code>0</code>), but you are encouraged to stick to the ones bellow.</p>
<table class="table">
<thead><tr class="header">
<th align="right">Level</th>
<th align="left">Name</th>
<th align="left">Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">0</td>
<td align="left">off</td>
<td align="left">A log level of 0/off tells a Logger or Appender to suspend all logging</td>
</tr>
<tr class="even">
<td align="right">100</td>
<td align="left">fatal</td>
<td align="left">Critical error that leads to program abort. Should always indicate a <code><a href="https://www.rdocumentation.org/packages/base/topics/stop">stop()</a></code> or similar</td>
</tr>
<tr class="odd">
<td align="right">200</td>
<td align="left">error</td>
<td align="left">A severe error that does not trigger program abort</td>
</tr>
<tr class="even">
<td align="right">300</td>
<td align="left">warn</td>
<td align="left">A potentially harmful situation, like <code><a href="https://www.rdocumentation.org/packages/base/topics/warning">warning()</a></code>
</td>
</tr>
<tr class="odd">
<td align="right">400</td>
<td align="left">info</td>
<td align="left">An informatinal message on the progress of the application</td>
</tr>
<tr class="even">
<td align="right">500</td>
<td align="left">debug</td>
<td align="left">Finer grained informational messages that are mostly useful for debugging</td>
</tr>
<tr class="odd">
<td align="right">600</td>
<td align="left">trace</td>
<td align="left">An even finer grained message than debug</td>
</tr>
<tr class="even">
<td align="right">NA</td>
<td align="left">all</td>
<td align="left">A log level of NA/all tells a Logger or Appender to process all log events</td>
</tr>
</tbody>
</table>
<p>The list of named log levels is stored as an option (<code><a href="https://www.rdocumentation.org/packages/base/topics/options">getOption("yog.log_levels")</a></code>) and you can use <code><a href="../reference/get_log_levels.html">add_log_levels()</a></code> and <code><a href="../reference/get_log_levels.html">remove_log_levels()</a></code> to define your own named levels if you want to. There are only predefined logging methods (<code>yog$fatal()</code>, etc..) for the standard log levels though.</p>
</div>
<div id="logging-with-the-root-logger" class="section level2">
<h2 class="hasAnchor">
<a href="#logging-with-the-root-logger" class="anchor"></a>Logging With the Root Logger</h2>
<p>Yog comes with a pre-configured root Logger. It is called <em>root</em> because you can <a href="#hierarchy">set up a tree of Loggers</a> that descent from it, but for basic use you will not have to worry about that.</p>
<div id="simplified-logging-syntax" class="section level3">
<h3 class="hasAnchor">
<a href="#simplified-logging-syntax" class="anchor"></a>Simplified Logging Syntax</h3>
<p>If you care about terse syntax you can use the following <code>UPPERCASE</code><a href="#fn1" class="footnoteRef" id="fnref1"><sup>1</sup></a> commands to log:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/simple_logging.html">FATAL</a></span>(<span class="st">"This is an important message about %s going wrong"</span>, <span class="st">"something"</span>)
<span class="co">#&gt; FATAL [13:10:07.156] This is an important message about something going wrong</span>
<span class="kw"><a href="../reference/simple_logging.html">ERROR</a></span>(<span class="st">"A less severe error"</span>)
<span class="co">#&gt; ERROR [13:10:07.161] A less severe error</span>
<span class="kw"><a href="../reference/simple_logging.html">WARN</a></span>(<span class="st">"something likely went wrong"</span>)
<span class="co">#&gt; WARN  [13:10:07.166] something likely went wrong</span>
<span class="kw"><a href="../reference/simple_logging.html">INFO</a></span>(<span class="st">"Everything is ok"</span>)
<span class="co">#&gt; INFO  [13:10:07.171] Everything is ok</span>
<span class="kw"><a href="../reference/simple_logging.html">DEBUG</a></span>(<span class="st">"Debug messages are hidden by default"</span>)
<span class="kw"><a href="../reference/simple_logging.html">console_threshold</a></span>(<span class="st">"debug"</span>)  <span class="co"># you must use lower case names here</span>
<span class="kw"><a href="../reference/simple_logging.html">DEBUG</a></span>(<span class="st">"unless we lower the threshold"</span>)
<span class="co">#&gt; DEBUG [13:10:07.177] unless we lower the threshold</span>
<span class="kw"><a href="../reference/simple_logging.html">TRACE</a></span>(<span class="st">"Trace is even lower than debug"</span>)</code></pre></div>
<p>If you have the package <strong>data.table</strong> installed, yog does not only log to the console, but also to an in memory <code>data.table</code>. You can use <code><a href="../reference/simple_logging.html">show_log()</a></code> to quickly display this in memory log<a href="#fn2" class="footnoteRef" id="fnref2"><sup>2</sup></a>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/simple_logging.html">show_log</a></span>(<span class="dv">3</span>)  <span class="co"># show the last 3 log entries</span>
<span class="co">#&gt; DEBUG [13:10:07] Debug messages are hidden by default</span>
<span class="co">#&gt; DEBUG [13:10:07] unless we lower the threshold</span>
<span class="co">#&gt; TRACE [13:10:07] Trace is even lower than debug</span></code></pre></div>
<p>If you looked carefully, you see that both debug messages were logged to memory (not only the one that you saw in the console). This is explained in the section on <a href="#thresholds">thresholds</a>.</p>
</div>
<div id="r6-logging-syntax" class="section level3">
<h3 class="hasAnchor">
<a href="#r6-logging-syntax" class="anchor"></a>R6 Logging Syntax</h3>
<p>You can also directly use Logger R6 objects to log. You can refer to the <em>root</em> logger with <code>yog$</code>. This is especially useful if you are working with multiple loggers (e.g. if you set up a separate Logger for a package you have developed). The examples in this vignette mostly use the notation below as it is more explicit:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">yog<span class="op">$</span><span class="kw">fatal</span>(<span class="st">"This is an important message about %s going wrong"</span>, <span class="st">"-&gt;something&lt;-"</span>)
<span class="co">#&gt; FATAL [13:10:07.197] This is an important message about -&gt;something&lt;- going wrong</span>
yog<span class="op">$</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/trace">trace</a></span>(<span class="st">"Trace messages are still hidden"</span>)
yog<span class="op">$</span>appenders<span class="op">$</span>console<span class="op">$</span><span class="kw">set_threshold</span>(<span class="st">"trace"</span>)
yog<span class="op">$</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/trace">trace</a></span>(<span class="st">"Unless we lower the threshold"</span>)
<span class="co">#&gt; TRACE [13:10:07.202] Unless we lower the threshold</span>
yog<span class="op">$</span>appenders<span class="op">$</span>memory<span class="op">$</span><span class="kw">show</span>(<span class="dv">3</span>)
<span class="co">#&gt; FATAL [13:10:07] This is an important message about -&gt;something&lt;- going wrong</span>
<span class="co">#&gt; TRACE [13:10:07] Trace messages are still hidden</span>
<span class="co">#&gt; TRACE [13:10:07] Unless we lower the threshold</span></code></pre></div>
</div>
<div id="formatting-strings" class="section level3">
<h3 class="hasAnchor">
<a href="#formatting-strings" class="anchor"></a>Formatting Strings</h3>
<p>You can use <code><a href="https://www.rdocumentation.org/packages/base/topics/sprintf">sprintf()</a></code> style formatting strings directly in log messages.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">yog<span class="op">$</span><span class="kw">info</span>(<span class="st">"The sky was the color of %s, tuned to a dead chanel"</span>, <span class="st">"television"</span>)
<span class="co">#&gt; INFO  [13:10:07.215] The sky was the color of television, tuned to a dead chanel</span>
<span class="kw"><a href="../reference/simple_logging.html">INFO</a></span>(<span class="st">"There are %.1f lights"</span>, <span class="fl">4.5321</span>)
<span class="co">#&gt; INFO  [13:10:07.217] There are 4.5 lights</span></code></pre></div>
</div>
</div>
<div id="log-events-the-atomic-unit-of-logging" class="section level2">
<h2 class="hasAnchor">
<a href="#log-events-the-atomic-unit-of-logging" class="anchor"></a>Log Events: The Atomic Unit of Logging</h2>
<p>wip</p>
</div>
<div id="thresholds" class="section level2">
<h2 class="hasAnchor">
<a href="#thresholds" class="anchor"></a>Thresholds &amp; Filters: Controlling Output Detail</h2>
<p>To control the level of detail of the log output, you can set <strong>thresholds</strong> for Loggers and Appenders. A Logger with a threshold of <code>warn</code> will only create LogEvents of the priorities <code>warn</code>, <code>error</code> and <code>fatal</code> and dispatch them to its Appenders.</p>
<blockquote>
<p>A <strong>threshold</strong> of a Logger or Appender is the minimum <strong>log level</strong> a LogEvent must have so that that Logger/Appender processes it.</p>
</blockquote>
<p>If you require more complex logic to decide whether a LogEvent should be created/processed you can also assign <strong>filters</strong> to Loggers/Appenders. They will be applied after the threshold is checked.</p>
<p>examples:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Only log on weekends</span>
f1 &lt;-<span class="st"> </span><span class="cf">function</span>(event, obj) { <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/as.POSIXlt">as.POSIXlt</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Sys.time">Sys.Date</a></span>())<span class="op">$</span>wday <span class="op">%in%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">7</span>, <span class="dv">0</span>) }
<span class="co"># Only log messages that contain the word bird</span>
f2 &lt;-<span class="st"> </span><span class="cf">function</span>(event, obj) { <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/grep">grepl</a></span>(<span class="st">"bird"</span>, event<span class="op">$</span>msg) }
yog<span class="op">$</span><span class="kw">set_filters</span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(f1, f2))

<span class="co"># since this is not very useful, we remove the filters again</span>
yog<span class="op">$</span><span class="kw">set_filters</span>(<span class="ot">NULL</span>)</code></pre></div>
</div>
<div id="appenders-managing-log-destinations" class="section level2">
<h2 class="hasAnchor">
<a href="#appenders-managing-log-destinations" class="anchor"></a>Appenders: Managing Log Destinations</h2>
<p>The root logger only logs to the console by default. If you want to redirect the output to a file you can just add a file appender to yog.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tf &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/tempfile">tempfile</a></span>()

<span class="co"># Add a new appender to a logger. We don't have to supply a name, but that</span>
<span class="co"># makes it easier to remove later.</span>
yog<span class="op">$</span><span class="kw"><a href="../reference/simple_logging.html">add_appender</a></span>(AppenderFile<span class="op">$</span><span class="kw">new</span>(<span class="dt">file =</span> tf), <span class="dt">name =</span> <span class="st">"file"</span>)

<span class="co"># configure yog so that it logs everything to the file, but only info and above</span>
<span class="co"># to the console</span>
yog<span class="op">$</span><span class="kw">set_threshold</span>(<span class="ot">NA</span>)
yog<span class="op">$</span>appenders<span class="op">$</span>console<span class="op">$</span><span class="kw">set_threshold</span>(<span class="st">"info"</span>)
yog<span class="op">$</span>appenders<span class="op">$</span>file<span class="op">$</span><span class="kw">set_threshold</span>(<span class="ot">NA</span>)
yog<span class="op">$</span><span class="kw">info</span>(<span class="st">"Another informational message"</span>)
<span class="co">#&gt; INFO  [13:10:07.289] Another informational message</span>
yog<span class="op">$</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/debug">debug</a></span>(<span class="st">"A debug message not shown by the console appender"</span>)

<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/readLines">readLines</a></span>(tf)
<span class="co">#&gt; [1] "INFO  [2018-12-24 13:10:07.289] Another informational message"                    </span>
<span class="co">#&gt; [2] "DEBUG [2018-12-24 13:10:07.292] A debug message not shown by the console appender"</span>

<span class="co"># Remove the appender again</span>
yog<span class="op">$</span><span class="kw"><a href="../reference/simple_logging.html">remove_appender</a></span>(<span class="st">"file"</span>)</code></pre></div>
</div>
<div id="hierarchy" class="section level2">
<h2 class="hasAnchor">
<a href="#hierarchy" class="anchor"></a>Inheritance: Hierarchical Loggers</h2>
<p>Logger hierarchies are a powerful concept to organize logging for different parts of a larger system. This is mainly relevant for package developers. It is good practice to have a sepparate Logger for each package. Since it is not common in R to build complex systems of hierarchically organised packages, hierarchies will usually be pretty flat (i.e. most Loggers will only inherit from the root logger).</p>
<p>Each newly created Logger is child to a parent Logger. If no parent Logger is specified manually during a Logger’s creation, its parent is the Root Logger. A logger dispatches the LogRecords it creates not only to its own Appenders, but also to the Appenders of all its ancestral Loggers (ignoring the threshold and Filters of the ancestral Loggers, but not of the ancestral Appenders).</p>
<p>If all this sounds confusing to you, take a look at the <a href="#examples-hierarchy">examples</a>. The common use cases are pretty easy to understand and illustrate the <em>how</em> and <em>why</em> pretty well.</p>
<div id="log-flow" class="section level3">
<h3 class="hasAnchor">
<a href="#log-flow" class="anchor"></a>Log Flow</h3>
<p>The graph bellow outlines the flow of LogEvents through the logging system. This is an important reference if you want to work with Filters and Logger hierarchies.</p>
<div class="figure">
<img src="log_flow.svg">
</div>
</div>
</div>
</div>
<div id="examples" class="section level1">
<h1 class="hasAnchor">
<a href="#examples" class="anchor"></a>Examples</h1>
<div id="logging-to-the-console" class="section level2">
<h2 class="hasAnchor">
<a href="#logging-to-the-console" class="anchor"></a>Logging to the console</h2>
<p>yog comes with simple formatting syntax. The configuration possibilites are limited, but should be sufficient for most users.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">lg &lt;-<span class="st"> </span>Logger<span class="op">$</span><span class="kw">new</span>(
  <span class="st">"test"</span>, 
  <span class="dt">appenders =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">cons =</span> AppenderConsole<span class="op">$</span><span class="kw">new</span>()), 
  <span class="dt">propagate =</span> <span class="ot">FALSE</span>
)

lg<span class="op">$</span><span class="kw">info</span>(<span class="st">"the default format"</span>)
<span class="co">#&gt; INFO  [13:10:07.324] the default format</span>

lg<span class="op">$</span>appenders<span class="op">$</span>cons<span class="op">$</span>layout<span class="op">$</span><span class="kw">set_fmt</span>(<span class="st">"%L (%n) [%t] %c(): !! %m !!"</span>)
lg<span class="op">$</span><span class="kw">info</span>(<span class="st">"A more involved custom format"</span>)
<span class="co">#&gt; INFO  (400) [13:10:07.328] eval(): !! A more involved custom format !!</span></code></pre></div>
<p>More complex formats are possible with <code>LayoutGlue</code> powered by the awesome <a href="https://github.com/tidyverse/glue">glue</a> package, at the cost of slightly worse performance.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># install.packages("glue")</span>

<span class="co"># WIP</span></code></pre></div>
</div>
<div id="logging-to-json-files" class="section level2">
<h2 class="hasAnchor">
<a href="#logging-to-json-files" class="anchor"></a>Logging to JSON files</h2>
<p>JavaScript Object Notation (JSON) is an open-standard file format that uses human-readable text to transmit data objects consisting of attribute–value pairs and array data types (<a href="https://en.wikipedia.org/wiki/JSON">wikipedia</a>). JSON is the <strong>recommended text-based logging format when logging to files</strong> <a href="#fn3" class="footnoteRef" id="fnref3"><sup>3</sup></a>, as it is human- as well as machine readable. You should only log to a different format if you have very good reasons for it.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># install.packages("jsonlite")</span>
tf &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/tempfile">tempfile</a></span>()

<span class="co"># AppenderJson is just a shortcut for AppenderFile with LayotJson as default</span>
<span class="co"># instead of Layout Format</span>
lg &lt;-<span class="st"> </span>Logger<span class="op">$</span><span class="kw">new</span>(
  <span class="st">"test logger"</span>,
  <span class="dt">appenders =</span> AppenderJson<span class="op">$</span><span class="kw">new</span>(<span class="dt">file =</span> tf), 
  <span class="dt">propagate =</span> <span class="ot">FALSE</span>
)

lg<span class="op">$</span><span class="kw">info</span>(<span class="st">"JSON naturally supports custom log fields"</span>, <span class="dt">field =</span> <span class="st">"custom"</span>)
lg<span class="op">$</span><span class="kw">info</span>(<span class="st">"You can serialize most R data types to JSON"</span>, <span class="dt">numbers =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>)
lg<span class="op">$</span><span class="kw">info</span>(<span class="st">"If you ever want to analyse your log files"</span>, <span class="dt">use =</span> <span class="st">"JSON"</span>)</code></pre></div>
<p>JSON is easy to parse and analyse with R</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/read_json_lines.html">read_json_lines</a></span>(tf)
<span class="co">#&gt;   level           timestamp caller</span>
<span class="co">#&gt; 1   400 2018-12-24 13:10:07   eval</span>
<span class="co">#&gt; 2   400 2018-12-24 13:10:07   eval</span>
<span class="co">#&gt; 3   400 2018-12-24 13:10:07   eval</span>
<span class="co">#&gt;                                           msg  field       numbers  use</span>
<span class="co">#&gt; 1   JSON naturally supports custom log fields custom          NULL &lt;NA&gt;</span>
<span class="co">#&gt; 2 You can serialize most R data types to JSON   &lt;NA&gt; 1, 2, 3, 4, 5 &lt;NA&gt;</span>
<span class="co">#&gt; 3  If you ever want to analyse your log files   &lt;NA&gt;          NULL JSON</span></code></pre></div>
<p>It is also human readable, though maybe this vignette does not transport that fact very well because of the lack of horizontal space</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cat">cat</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/readLines">readLines</a></span>(tf), <span class="dt">sep =</span> <span class="st">"</span><span class="ch">\n\n</span><span class="st">"</span>)
<span class="co">#&gt; {"level":400,"timestamp":"2018-12-24 13:10:07","caller":"eval","msg":"JSON naturally supports custom log fields","field":"custom"}</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; {"level":400,"timestamp":"2018-12-24 13:10:07","caller":"eval","msg":"You can serialize most R data types to JSON","numbers":[1,2,3,4,5]}</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; {"level":400,"timestamp":"2018-12-24 13:10:07","caller":"eval","msg":"If you ever want to analyse your log files","use":"JSON"}</span></code></pre></div>
</div>
<div id="examples-hierarchy" class="section level2">
<h2 class="hasAnchor">
<a href="#examples-hierarchy" class="anchor"></a>Logger Hierarchies</h2>
<p>The most common usecases for creating a new Logger rather than just using the root Logger is if you create a Package that should contain logging. This way you can have separate Appenders (e.g logfiles) and thresholds for each package.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># The logger name should be the same as the package name</span>
tf &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/tempfile">tempfile</a></span>()
lg &lt;-<span class="st"> </span>Logger<span class="op">$</span><span class="kw">new</span>(<span class="st">"mypackage"</span>, <span class="dt">appenders =</span> AppenderFile<span class="op">$</span><span class="kw">new</span>(tf))  </code></pre></div>
<p>The <code><a href="https://www.rdocumentation.org/packages/base/topics/print">print()</a></code> method for Loggers gives a nice overview of the newly created logger:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/print">print</a></span>(lg)
<span class="co">#&gt; &lt;Logger&gt; [info] mypackage -&gt; root</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; appenders:</span>
<span class="co">#&gt;   NA: &lt;AppenderFile&gt; [all] -&gt; /tmp/Rtmp4nJT0y/file1dfc7c3e939d</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; inherited appenders:</span>
<span class="co">#&gt;   console: &lt;AppenderConsole&gt; [info] -&gt; console</span>
<span class="co">#&gt;   memory : &lt;AppenderDt&gt;      [ all] -&gt; in memory data.table</span></code></pre></div>
<p>This tells us that <code>lg</code> logs all events of at least level <code>info</code>. It does have a single (unnamed) Appender that logs to a temporary file, and dispatches all LogEvents it creates to the Appenders of the root Logger (ignoring the threshold and filters of the root Logger, but not of the Appenders).</p>
<p>We can use <code>lg$fatal()</code>, <code>lg$info()</code>, etc.. to log messages with this Logger:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">lg<span class="op">$</span><span class="kw">info</span>(<span class="st">"A test message for lg"</span>)
<span class="co">#&gt; INFO  [13:10:07.518] A test message for lg</span></code></pre></div>
<p>If we do not want <code>lg</code> to dispatch to the root Logger, we can set <code>propagate</code> to <code>FALSE</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">lg<span class="op">$</span><span class="kw">set_propagate</span>(<span class="ot">FALSE</span>)</code></pre></div>
<p>When we take a look at the Logger again, we now see that it does not inherit any Appenders anymore</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/print">print</a></span>(lg)
<span class="co">#&gt; &lt;Logger&gt; [info] mypackage | root</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; appenders:</span>
<span class="co">#&gt;   NA: &lt;AppenderFile&gt; [all] -&gt; /tmp/Rtmp4nJT0y/file1dfc7c3e939d</span></code></pre></div>
<p>Consequently, <code>lg</code> no longer outputs log messages to he console</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">lg<span class="op">$</span><span class="kw">info</span>(<span class="st">"Nothing to see here"</span>)</code></pre></div>
</div>
</div>
<div class="footnotes">
<hr>
<ol>
<li id="fn1"><p>If you are wondering why I decided on <code>ALL-CAPS</code> for the logging functions: It distinquishes log calls well from normal code, and also all the good names are already taken by base R functions (<code><a href="https://www.rdocumentation.org/packages/base/topics/Log">log()</a></code>, <code><a href="https://www.rdocumentation.org/packages/base/topics/trace">trace()</a></code>, <code><a href="https://www.rdocumentation.org/packages/base/topics/debug">debug()</a></code>). Many R packages deal with this issue by using prefixes (like <code>log_debug()</code>), but I do not like that idea. In any case that is pretty to close to what you get when you use the R6 logging syntax<a href="#fnref1">↩</a></p></li>
<li id="fn2"><p>If you want to know more about interacting with the data.table Appender see the help for <code><a href="../reference/AppenderDt.html">?AppenderDt</a></code>.<a href="#fnref2">↩</a></p></li>
<li id="fn3"><p>Technically, the logger does not produce standard JSON files but <a href="http://jsonlines.org/">JSON lines</a><a href="#fnref3">↩</a></p></li>
</ol>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li>
<a href="#introduction">Introduction</a><ul class="nav nav-pills nav-stacked">
<li><a href="#quickstart">Quickstart</a></li>
      </ul>
</li>
      <li>
<a href="#usage">Usage</a><ul class="nav nav-pills nav-stacked">
<li><a href="#structure-of-the-logging-system">Structure of the Logging System</a></li>
      <li><a href="#log-levels">Log Levels</a></li>
      <li><a href="#logging-with-the-root-logger">Logging With the Root Logger</a></li>
      <li><a href="#log-events-the-atomic-unit-of-logging">Log Events: The Atomic Unit of Logging</a></li>
      <li><a href="#thresholds">Thresholds &amp; Filters: Controlling Output Detail</a></li>
      <li><a href="#appenders-managing-log-destinations">Appenders: Managing Log Destinations</a></li>
      <li><a href="#hierarchy">Inheritance: Hierarchical Loggers</a></li>
      </ul>
</li>
      <li>
<a href="#examples">Examples</a><ul class="nav nav-pills nav-stacked">
<li><a href="#logging-to-the-console">Logging to the console</a></li>
      <li><a href="#logging-to-json-files">Logging to JSON files</a></li>
      <li><a href="#examples-hierarchy">Logger Hierarchies</a></li>
      </ul>
</li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Stefan Fleck.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.9000.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
