<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Format Log Events for Output to Databases — LayoutDbi • lgr</title>

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script>

<!-- sticky kit -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>



<meta property="og:title" content="Format Log Events for Output to Databases — LayoutDbi" />

<meta property="og:description" content="DBI Layouts convert LogEvents to a data.frames that can
be appended to an existing database table. Via the col_types parameter
they can also store information that AppenderDbi can use to create new
database tables; however, it is safer and more flexible to set up the log
table up manually with an SQL CREATE TABLE statement instead." />
<meta name="twitter:card" content="summary" />



<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">lgr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.7.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/lgr.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/lgr-recipes.html">Example Configurations for lgr</a>
    </li>
    <li>
      <a href="../articles/lgr-simple.html">lgr-simple</a>
    </li>
  </ul>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/s-fleck/lgr">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Format Log Events for Output to Databases</h1>
    <small class="dont-index">Source: <a href='https://github.com/s-fleck/lgr/blob/master/R/Layout.R'><code>R/Layout.R</code></a></small>
    <div class="hidden name"><code>LayoutDbi.Rd</code></div>
    </div>

    <div class="ref-description">
    
    <p>DBI Layouts convert <a href='LogEvent.html'>LogEvents</a> to a <code>data.frames</code> that can
be appended to an existing database table. Via the <code>col_types</code> parameter
they can also store information that <a href='AppenderDbi.html'>AppenderDbi</a> can use to create new
database tables; however, it is safer and more flexible to set up the log
table up manually with an <code>SQL CREATE TABLE</code> statement instead.</p>
    
    </div>

        
    <h2 class="hasAnchor" id="usage"><a class="anchor" href="#usage"></a>Usage</h2>

    <pre>
x &lt;- x$new(event_values = NULL, col_types = NULL)
    x$format_event(event)
x$set_col_types(x)
x$sql_create_table(table)
x$clone(deep = FALSE)
x$set_event_values(x)
x$set_val_names(x)
    x$col_names
x$col_types
x$event_values
x$val_names
    </pre>
    
    <h2 class="hasAnchor" id="creating-a-new-layout"><a class="anchor" href="#creating-a-new-layout"></a>Creating a New Layout</h2>

    
    <p>Layouts are instantiated with <code>&lt;LayoutSubclass&gt;$new()</code>. For a description of
the arguments to this function please refer to the Fields section.</p>
    
    <h2 class="hasAnchor" id="fields"><a class="anchor" href="#fields"></a>Fields</h2>

    
    <dl class='dl-horizontal'>
<dt><code>col_types</code></dt><dd><p>A named <code>character</code> vector of column types supported by
the target database. If this is used instead of <code>event_values</code>, and
the target logging <code>table</code> does not yet exist, the column type
information is used by <a href='AppenderDbi.html'>AppenderDbi</a> or similar Appenders to create a
new database table, either on instantion of the Appender or on writing
of the first LogEvent. If the target database table already exists,
the column type information is not used. You can only supply one of
<code>event_values</code> and <code>col_types</code>.</p></dd>
<dt><code>col_names</code></dt><dd><p>Convenience method to get the names of the <code>col_types</code>
vector</p></dd>
</dl>
    
    <h2 class="hasAnchor" id="methods"><a class="anchor" href="#methods"></a>Methods</h2>

    
    <dl class='dl-horizontal'>
<dt><code>format_event(event)</code></dt><dd><p>format a <a href='LogEvent.html'>LogEvent</a></p></dd>
</dl>
    
    <h2 class="hasAnchor" id="database-specific-layouts"><a class="anchor" href="#database-specific-layouts"></a>Database Specific Layouts</h2>

    
    <p>Different databases have different data types and features. Currently the
following <code>LayoutDBI</code> subclasses exist that deal with specific databases,
but this list is expected to grow as lgr matures:</p><ul>
<li><p><code>LayoutSQLite</code>: Needs its own Layout because SQLite does not support
<code>timestamps</code></p></li>
<li><p><code>LayoutDBI</code>: For all other datbases</p></li>
</ul>
    <p>The utility function <code><a href='select_dbi_layout.html'>select_dbi_layout()</a></code> returns the appropriate
Layout for a DBI connection.</p>
    
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='select_dbi_layout.html'>select_dbi_layout()</a></code>, <a href='https://www.rdocumentation.org/packages/DBI/topics/DBI-package'>DBI::DBI</a>,</p>
<p>Other Layouts: <code><a href='LayoutFormat.html'>LayoutFormat</a></code>,
  <code><a href='LayoutGlue.html'>LayoutGlue</a></code>, <code><a href='LayoutJson.html'>LayoutJson</a></code>,
  <code><a href='LayoutTable.html'>LayoutTable</a></code>, <code><a href='Layout.html'>Layout</a></code></p></div>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'># setup a dummy LogEvent</span>
<span class='no'>event</span> <span class='kw'>&lt;-</span> <span class='no'>LogEvent</span>$<span class='fu'>new</span>(
  <span class='kw'>logger</span> <span class='kw'>=</span> <span class='no'>Logger</span>$<span class='fu'>new</span>(<span class='st'>"dummy logger"</span>, <span class='kw'>user</span> <span class='kw'>=</span> <span class='st'>"testuser"</span>),
  <span class='kw'>level</span> <span class='kw'>=</span> <span class='fl'>200</span>,
  <span class='kw'>timestamp</span> <span class='kw'>=</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/Sys.time'>Sys.time</a></span>(),
  <span class='kw'>caller</span> <span class='kw'>=</span> <span class='fl'>NA_character_</span>,
  <span class='kw'>msg</span> <span class='kw'>=</span> <span class='st'>"a test message"</span>
)

<span class='co'># defaults</span>
<span class='no'>lo</span> <span class='kw'>&lt;-</span> <span class='no'>LayoutDbi</span>$<span class='fu'>new</span>()
<span class='no'>lo</span>$<span class='fu'>format_event</span>(<span class='no'>event</span>)</div><div class='output co'>#&gt;   level           timestamp caller            msg
#&gt; 1   200 2019-01-03 16:16:49   &lt;NA&gt; a test message</div><div class='input'>
<span class='co'># SQLite does not support timestamps so LayoutSqlite converts them to text</span>
<span class='no'>lo</span> <span class='kw'>&lt;-</span> <span class='no'>LayoutSqlite</span>$<span class='fu'>new</span>()
<span class='fu'><a href='https://www.rdocumentation.org/packages/utils/topics/str'>str</a></span>(<span class='no'>lo</span>$<span class='fu'>format_event</span>(<span class='no'>event</span>))</div><div class='output co'>#&gt; 'data.frame':	1 obs. of  4 variables:
#&gt;  $ level    : num 200
#&gt;  $ timestamp: chr "2019-01-03 16:16:49"
#&gt;  $ caller   : chr NA
#&gt;  $ msg      : chr "a test message"</div><div class='input'>
<span class='co'># advanced example that supports a custom_field:</span>
<span class='no'>lo</span> <span class='kw'>&lt;-</span> <span class='no'>LayoutDbi</span>$<span class='fu'>new</span>(
  <span class='kw'>col_types</span> <span class='kw'>=</span>  <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/c'>c</a></span>(
    <span class='kw'>timestamp</span> <span class='kw'>=</span> <span class='st'>"timestamp"</span>,
    <span class='kw'>level</span> <span class='kw'>=</span> <span class='st'>"smallint"</span>,
    <span class='kw'>msg</span> <span class='kw'>=</span> <span class='st'>"varchar(2048)"</span>,
    <span class='kw'>custom_field</span> <span class='kw'>=</span> <span class='st'>"integer"</span>
  )
)

<span class='no'>event</span> <span class='kw'>&lt;-</span> <span class='no'>LogEvent</span>$<span class='fu'>new</span>(
  <span class='kw'>logger</span> <span class='kw'>=</span> <span class='no'>Logger</span>$<span class='fu'>new</span>(<span class='st'>"dummy logger"</span>, <span class='kw'>user</span> <span class='kw'>=</span> <span class='st'>"testuser"</span>),
  <span class='kw'>level</span> <span class='kw'>=</span> <span class='fl'>200</span>,
  <span class='kw'>timestamp</span> <span class='kw'>=</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/Sys.time'>Sys.time</a></span>(),
  <span class='kw'>caller</span> <span class='kw'>=</span> <span class='fl'>NA_character_</span>,
  <span class='kw'>msg</span> <span class='kw'>=</span> <span class='st'>"a test message"</span>,
  <span class='kw'>custom_field</span> <span class='kw'>=</span> <span class='st'>"blubb"</span>
)

<span class='no'>lo</span>$<span class='fu'>format_event</span>(<span class='no'>event</span>)</div><div class='output co'>#&gt;             timestamp level            msg custom_field
#&gt; 1 2019-01-03 16:16:49   200 a test message        blubb</div><div class='input'>
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      
      <li><a href="#usage">Usage</a></li>

      <li><a href="#creating-a-new-layout">Creating a New Layout</a></li>

      <li><a href="#fields">Fields</a></li>

      <li><a href="#methods">Methods</a></li>

      <li><a href="#database-specific-layouts">Database Specific Layouts</a></li>

      <li><a href="#see-also">See also</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by Stefan Fleck.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.9000.</p>
</div>
      </footer>
   </div>

  

  </body>
</html>

