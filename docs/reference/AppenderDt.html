<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Log to an In-Memory Data.Table — AppenderDt • lgr</title>

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script>

<!-- sticky kit -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>



<meta property="og:title" content="Log to an In-Memory Data.Table — AppenderDt" />

<meta property="og:description" content="An Appender that outputs to an in-memory data.table. This kind of
Appender is useful for interactive use, and has very little overhead." />
<meta name="twitter:card" content="summary" />



<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">lgr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2.2.9003</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/lgr.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/s-fleck/lgr">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Log to an In-Memory Data.Table</h1>
    <small class="dont-index">Source: <a href='https://github.com/s-fleck/lgr/blob/master/R/Appender.R'><code>R/Appender.R</code></a></small>
    <div class="hidden name"><code>AppenderDt.Rd</code></div>
    </div>

    <div class="ref-description">
    
    <p>An Appender that outputs to an in-memory <code>data.table</code>. This kind of
Appender is useful for interactive use, and has very little overhead.</p>
    
    </div>

        
    <h2 class="hasAnchor" id="custom-fields"><a class="anchor" href="#custom-fields"></a>Custom Fields</h2>

    
    <p><code>AppenderDt</code> supports <a href='LogEvent.html'>custom fields</a>, but they have to be
pre-allocated in the <code>prototype</code> argument. Custom fields that are not
part of the prototype are discarded. If you want an Appender that retains
all custom fields (at the cost of slightly less performance), take a look at
<a href='AppenderBuffer.html'>AppenderBuffer</a>.</p>
<p>With the default settings, the custom field <code>value</code> is included in the
<code>data.table</code> as a list column to store arbitrary <span style="R">R</span> objects (see example).
It is recommended to use this feature only <code>TRACE</code> level.</p>
    
    <h2 class="hasAnchor" id="usage"><a class="anchor" href="#usage"></a>Usage</h2>

    <pre>
x &lt;- AppenderDt$new(threshold = NA_integer_, layout = LayoutFormat$new(fmt =
  "%L [%t] %m %f", timestamp_fmt = "%H:%M:%OS3", colors =
  getOption("lgr.colors", list())), prototype = data.table::data.table(.id =
  NA_integer_, level = NA_integer_, timestamp = Sys.time(), logger =
  NA_character_, caller = NA_character_, msg = NA_character_, .custom =
  list(list())), buffer_size = 1e+05, filters = NULL)
    x$add_filter(filter, name = NULL)
x$append(event)
x$filter(event)
x$remove_filter(pos)
x$set_filters(filters)
x$set_layout(layout)
x$set_threshold(level)
x$show(threshold = NA_integer_, n = 20L)
    x$data
x$destination
x$dt
x$filters
x$layout
x$threshold
    </pre>
    
    <h2 class="hasAnchor" id="creating-a-data-table-appender"><a class="anchor" href="#creating-a-data-table-appender"></a>Creating a Data Table Appender</h2>

    
    <p>In addition to the usual fields, <code>AppenderDt$new()</code> requires that you supply
a <code>buffer_size</code> and a <code>prototype</code>. These determine the structure of the
<code>data.table</code> used to store the log this appender creates and cannot be
modified anymore after the instantiation of the appender.</p>
<p>The <a href='Layout.html'>Layout</a> for this Appender is used only to format console output of
its <code>$show()</code> method.</p>
<dl class='dl-horizontal'>
<dt>buffer_size</dt><dd><p><code>integer</code> scalar. Number of rows of the in-memory
<code>data.table</code></p></dd>
<dt>prototype</dt><dd><p>A prototype <code>data.table</code>. The prototype must be a
<code>data.table</code> with the same columns and column types as the data
you want to log. The actual content of the columns is irrelevant.
There are a few columns that have special meaning, based on their name:
<ul>
<li><p><code>.id</code>: <code>integer</code> (mandatory). Must always be the first column
and is used internally by the Appender</p></li>
<li><p><code>.custom</code>: <code>list</code> (optional). If present all custom values of the
event (that are not already part of the prototype) are stored in
this list column.</p></li>
</ul></p></dd>
</dl>
    
    <h2 class="hasAnchor" id="fields"><a class="anchor" href="#fields"></a>Fields</h2>

    
    <dl class='dl-horizontal'>
<dt><code>dt</code></dt><dd><p>Get the log recorded by this <code>Appender</code> as a <code>data.table</code>
with a maximum of <code>buffer_size</code> rows</p></dd>
</dl>
    <dl class='dl-horizontal'>
<dt><code>data</code></dt><dd><p>Get the log recorded by this <code>Appender</code> as a <code>data.frame</code></p></dd>
</dl>
    <dl class='dl-horizontal'>
<dt><code>threshold</code>, <code>set_threshold(level)</code></dt><dd><p><code>character</code> or <code>integer</code> scalar.
The minimum log level that triggers this logger. See <a href='get_log_levels.html'>log_levels</a></p></dd>
<dt><code>layout</code>, <code>set_layout(layout)</code></dt><dd><p>a <code>Layout</code> that will be used for
formatting the <code>LogEvents</code> passed to this Appender</p></dd>
<dt><code>destination</code></dt><dd><p>The output destination of the <code>Appender</code> in
human-readable form (mainly for print output)</p></dd>
</dl>
    <dl class='dl-horizontal'>
<dt><code>filters</code>, <code>set_filters(filters)</code></dt><dd><p>a <code>list</code> that may contain
<code>functions</code> or any <span style="R">R</span> object with a <code><a href='https://www.rdocumentation.org/packages/stats/topics/filter'>filter()</a></code> method. These functions
must have exactly one argument: <code>event</code> which will get passed the
LogEvent when the Filterable's <code><a href='https://www.rdocumentation.org/packages/stats/topics/filter'>filter()</a></code> method is invoked.
If all of these functions evaluate to <code>TRUE</code> the LogEvent is passed on.
Since LogEvents have reference semantics, filters can also be abused to
modify them before they are passed on. Look at the source code of
<code><a href='with_log_level.html'>with_log_level()</a></code> or <code><a href='with_log_level.html'>with_log_value()</a></code> for examples.</p></dd>
</dl>
    
    <h2 class="hasAnchor" id="methods"><a class="anchor" href="#methods"></a>Methods</h2>

    
    <dl class='dl-horizontal'>
<dt><code>show(n, threshold)</code></dt><dd><p>Show the last <code>n</code> log entries with a log level
bellow <code>threshold</code>. The log entries will be formatted for console output
via this Appenders <a href='Layout.html'>Layout</a></p></dd>
</dl>
    <dl class='dl-horizontal'>
<dt><code><a href='https://www.rdocumentation.org/packages/base/topics/append'>append(event)</a></code></dt><dd><p>Tell the Appender to process a <a href='LogEvent.html'>LogEvent</a> <code>event</code>.
This method is usually not called by the user, but invoked by a
<a href='Logger.html'>Logger</a></p></dd>
</dl>
    <dl class='dl-horizontal'>
<dt><code><a href='https://www.rdocumentation.org/packages/stats/topics/filter'>filter(event)</a></code></dt><dd><p>Determine whether the LogEvent <code>x</code> should be passed
on to Appenders (<code>TRUE</code>) or not (<code>FALSE</code>). See also the active binding
<code>filters</code></p></dd>
<dt><code>add_filter(filter, name = NULL)</code>, <code>remove_filter(pos)</code></dt><dd><p>Add or remove a filter. When adding a filter an optional <code>name</code> can
be specified. <code>remove_filter()</code> can remove by position or name (if one
was specified)</p></dd>
</dl>
    
    <h2 class="hasAnchor" id="comparison-appenderbuffer-and-appenderdt"><a class="anchor" href="#comparison-appenderbuffer-and-appenderdt"></a>Comparison AppenderBuffer and AppenderDt</h2>

    
    <p>Both <a href='AppenderBuffer.html'>AppenderBuffer</a> and AppenderDt do in memory buffering of events.
AppenderBuffer retains a copies of the events it processes and has the
ability to pass the buffered events on to other Appenders. AppenderDt
converts the events to rows in a <code>data.table</code> and is a bit harder to
configure. Used inside loops (several hundred iterations),
AppenderDt has much less overhead than AppenderBuffer. For single logging
calls and small loops, AppenderBuffer is more performant. This is related to
how memory pre-allocation is handled by the appenders.</p>
<p>In short: Use AppenderDt if you want an in-memory log for interactive use,
and AppenderBuffer if you actually want to buffer events</p>
    
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><a href='LayoutFormat.html'>LayoutFormat</a>, <a href='simple_logging.html'>simple_logging</a>, <a href='https://www.rdocumentation.org/packages/data.table/topics/data.table'>data.table::data.table</a></p></div>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='no'>lg</span> <span class='kw'>&lt;-</span> <span class='no'>Logger</span>$<span class='fu'>new</span>(
  <span class='st'>"test"</span>,
  <span class='kw'>appenders</span> <span class='kw'>=</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/list'>list</a></span>(<span class='kw'>memory</span> <span class='kw'>=</span> <span class='no'>AppenderDt</span>$<span class='fu'>new</span>()),
  <span class='kw'>threshold</span> <span class='kw'>=</span> <span class='fl'>NA</span>,
  <span class='kw'>propagate</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>  <span class='co'># to prevent routing to root logger for this example</span>
)
<span class='no'>lg</span>$<span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/debug'>debug</a></span>(<span class='st'>"test"</span>)
<span class='no'>lg</span>$<span class='fu'>error</span>(<span class='st'>"test"</span>)

<span class='co'># Displaying the log</span>
<span class='no'>lg</span>$<span class='no'>appenders</span>$<span class='no'>memory</span>$<span class='no'>data</span></div><div class='output co'>#&gt;   .id level           timestamp logger caller  msg .custom
#&gt; 1   1   500 2019-05-20 11:18:21   test   eval test    NULL
#&gt; 2   2   200 2019-05-20 11:18:21   test   eval test    NULL</div><div class='input'><span class='no'>lg</span>$<span class='no'>appenders</span>$<span class='no'>memory</span>$<span class='fu'>show</span>()</div><div class='output co'>#&gt; <span style='color: #808080;'>DEBUG</span><span> [11:18:21.523] test 
#&gt; </span><span style='color: #D75F5F;'>ERROR</span><span> [11:18:21.551] test </div><div class='input'><span class='fu'><a href='simple_logging.html'>show_log</a></span>(<span class='kw'>target</span> <span class='kw'>=</span> <span class='no'>lg</span>$<span class='no'>appenders</span>$<span class='no'>memory</span>)</div><div class='output co'>#&gt; </span><span style='color: #808080;'>DEBUG</span><span> [11:18:21.523] test 
#&gt; </span><span style='color: #D75F5F;'>ERROR</span><span> [11:18:21.551] test </div><div class='input'>
<span class='co'># If you pass a Logger to show_log(), it looks for the first AppenderDt</span>
<span class='co'># that it can find.</span>
<span class='fu'><a href='simple_logging.html'>show_log</a></span>(<span class='kw'>target</span> <span class='kw'>=</span> <span class='no'>lg</span>)</div><div class='output co'>#&gt; </span><span style='color: #808080;'>DEBUG</span><span> [11:18:21.523] test 
#&gt; </span><span style='color: #D75F5F;'>ERROR</span><span> [11:18:21.551] test </div><div class='input'>
<span class='co'># Custom fields are stored in the list column .custom by default</span>
<span class='no'>lg</span>$<span class='fu'>info</span>(<span class='st'>"the iris data frame"</span>, <span class='kw'>caps</span> <span class='kw'>=</span> <span class='no'>LETTERS</span>[<span class='fl'>1</span>:<span class='fl'>5</span>])
<span class='no'>lg</span>$<span class='no'>appenders</span>$<span class='no'>memory</span>$<span class='no'>data</span></div><div class='output co'>#&gt;   .id level           timestamp logger caller                 msg       .custom
#&gt; 1   1   500 2019-05-20 11:18:21   test   eval                test          NULL
#&gt; 2   2   200 2019-05-20 11:18:21   test   eval                test          NULL
#&gt; 3   3   400 2019-05-20 11:18:21   test   eval the iris data frame A, B, C, D, E</div><div class='input'><span class='no'>lg</span>$<span class='no'>appenders</span>$<span class='no'>memory</span>$<span class='no'>data</span>$<span class='no'>.custom</span><span class='kw'>[[</span><span class='fl'>3</span>]]$<span class='no'>caps</span></div><div class='output co'>#&gt; [1] "A" "B" "C" "D" "E"</div><div class='input'>
</div></span></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      
      <li><a href="#custom-fields">Custom Fields</a></li>

      <li><a href="#usage">Usage</a></li>

      <li><a href="#creating-a-data-table-appender">Creating a Data Table Appender</a></li>

      <li><a href="#fields">Fields</a></li>

      <li><a href="#methods">Methods</a></li>

      <li><a href="#comparison-appenderbuffer-and-appenderdt">Comparison AppenderBuffer and AppenderDt</a></li>

      <li><a href="#see-also">See also</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by Stefan Fleck.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.9000.</p>
</div>
      </footer>
   </div>

  

  </body>
</html>

