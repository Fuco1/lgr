---
title: "Example Configurations for lgr"
author: "Stefan Fleck"
date: "`r Sys.Date()`"
output: 
  rmarkdown::html_vignette:
    toc: true
    number_sections: true
vignette: >
  %\VignetteIndexEntry{lgr-examples}
  %\VignetteEncoding{UTF-8}
  %\VignetteEngine{knitr::rmarkdown}
editor_options: 
  chunk_output_type: console
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```


# Adding a Custom Logger to a Package

If you are a package author, it is good practice to define a separate logger
for your package. This gives users the ability to easily enable/disable 
logging on a per-package basis. To do this you must put the following code
into any `.R` file inside the `R/` directory of your package:

```{r}
# mypackage/R/mypackage-package.R
.onLoad <- function(...){
  assign(
    "llg",
    lgr::Logger$new(name = "mypackage"),  # the logger name should be the same as the package name
    envir = parent.env(environment())
  )
}

```

You can also use `lgr::use_logger()` to generate the appropriate code for your
page, so that you just have to copy and paste.

After you set this up you can use `lg$fatal()`, `lg$info()`, etc... 
inside your package. You do not have to define any appenders, since all log 
events will get redirected to the Root Logger (see the chapter on hierarchical 
logging in the `lgr` main vignette). 



# Recommended Logger Setup

The out-of-the-box setup for the Root Logger is minimal to make it easy
to use for newcommers. I prefer to set up my logger like this:

```{r, eval = FALSE}

tf <- tempfile()

lg <- Logger$new(
  "buffer example",
  propagate = FALSE,  # to suppress console output
  appenders = AppenderBuffer$new(
    buffer_size = 5,
    flush_on_exit = FALSE,
    flush_on_rotate = FALSE,
    should_flush = function(event) event$level <= 200,
    appenders = AppenderFile$new(tf)
  )
)

for (i in 1:10) lg$info("Iteration %s", i)

lg$error("A log level <= 200 ('error') triggers flushing")

readLines(tf)


```



